//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/larry/dev/workspace/realtime/realtime-channel/src/main/java/com/goodow/realtime/objc/ObjCScheduler.java
//

#include "J2ObjC_source.h"
#include "com/goodow/realtime/core/Handler.h"
#include "com/goodow/realtime/json/Json.h"
#include "com/goodow/realtime/json/JsonObject.h"
#include "com/goodow/realtime/objc/ObjCScheduler.h"
#include "java/util/concurrent/atomic/AtomicInteger.h"

#import "GDChannel.h"

__attribute__((unused)) static void ComGoodowRealtimeObjcObjCScheduler_nativeCancelTimerWithId_(id timer);
__attribute__((unused)) static void ComGoodowRealtimeObjcObjCScheduler_nativeHandleWithId_withId_(id handler, id event);
__attribute__((unused)) static id ComGoodowRealtimeObjcObjCScheduler_nativeScheduleTimerWithInt_withBoolean_withComGoodowRealtimeCoreHandler_(jint delayMs, jboolean repeat, id<ComGoodowRealtimeCoreHandler> handler);

@interface ComGoodowRealtimeObjcObjCScheduler () {
 @public
  JavaUtilConcurrentAtomicAtomicInteger *timerId_;
  id<ComGoodowRealtimeJsonJsonObject> timers_;
}

+ (void)nativeCancelTimerWithId:(id)timer;

+ (void)nativeHandleWithId:(id)handler
                    withId:(id)event;

+ (id)nativeScheduleTimerWithInt:(jint)delayMs
                     withBoolean:(jboolean)repeat
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler;
@end

J2OBJC_FIELD_SETTER(ComGoodowRealtimeObjcObjCScheduler, timerId_, JavaUtilConcurrentAtomicAtomicInteger *)
J2OBJC_FIELD_SETTER(ComGoodowRealtimeObjcObjCScheduler, timers_, id<ComGoodowRealtimeJsonJsonObject>)

@implementation ComGoodowRealtimeObjcObjCScheduler

+ (void)nativeCancelTimerWithId:(id)timer {
  ComGoodowRealtimeObjcObjCScheduler_nativeCancelTimerWithId_(timer);
}

+ (void)nativeHandleWithId:(id)handler
                    withId:(id)event {
  ComGoodowRealtimeObjcObjCScheduler_nativeHandleWithId_withId_(handler, event);
}

+ (id)nativeScheduleTimerWithInt:(jint)delayMs
                     withBoolean:(jboolean)repeat
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  return ComGoodowRealtimeObjcObjCScheduler_nativeScheduleTimerWithInt_withBoolean_withComGoodowRealtimeCoreHandler_(delayMs, repeat, handler);
}

- (jboolean)cancelTimerWithInt:(jint)id_ {
  NSString *key = JreStrcat("I", id_);
  if ([((id<ComGoodowRealtimeJsonJsonObject>) nil_chk(timers_)) hasWithNSString:key]) {
    ComGoodowRealtimeObjcObjCScheduler_nativeCancelTimerWithId_([timers_ getWithNSString:key]);
    (void) [timers_ removeWithNSString:key];
    return YES;
  }
  return NO;
}

- (void)handleWithId:(id)handler
              withId:(id)event {
  if ([ComGoodowRealtimeCoreHandler_class_() isInstance:handler]) {
    [((id<ComGoodowRealtimeCoreHandler>) nil_chk(((id<ComGoodowRealtimeCoreHandler>) check_protocol_cast(handler, @protocol(ComGoodowRealtimeCoreHandler))))) handleWithId:event];
  }
  else {
    ComGoodowRealtimeObjcObjCScheduler_nativeHandleWithId_withId_(handler, event);
  }
}

- (void)scheduleDeferredWithComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  [[NSRunLoop mainRunLoop] performSelector:@selector(handleWithId:)
  target:handler
  argument:nil
  order:0
  modes:@[NSDefaultRunLoopMode]];
}

- (jint)scheduleDelayWithInt:(jint)delayMs
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  jint id_ = [((JavaUtilConcurrentAtomicAtomicInteger *) nil_chk(timerId_)) getAndIncrement];
  (void) [((id<ComGoodowRealtimeJsonJsonObject>) nil_chk(timers_)) setWithNSString:JreStrcat("I", id_) withId:ComGoodowRealtimeObjcObjCScheduler_nativeScheduleTimerWithInt_withBoolean_withComGoodowRealtimeCoreHandler_(delayMs, NO, handler)];
  return id_;
}

- (jint)schedulePeriodicWithInt:(jint)delayMs
withComGoodowRealtimeCoreHandler:(id<ComGoodowRealtimeCoreHandler>)handler {
  jint id_ = [((JavaUtilConcurrentAtomicAtomicInteger *) nil_chk(timerId_)) getAndIncrement];
  (void) [((id<ComGoodowRealtimeJsonJsonObject>) nil_chk(timers_)) setWithNSString:JreStrcat("I", id_) withId:ComGoodowRealtimeObjcObjCScheduler_nativeScheduleTimerWithInt_withBoolean_withComGoodowRealtimeCoreHandler_(delayMs, YES, handler)];
  return id_;
}

- (instancetype)init {
  if (self = [super init]) {
    timerId_ = [[JavaUtilConcurrentAtomicAtomicInteger alloc] initWithInt:0];
    timers_ = ComGoodowRealtimeJsonJson_createObject();
  }
  return self;
}

- (void)copyAllFieldsTo:(ComGoodowRealtimeObjcObjCScheduler *)other {
  [super copyAllFieldsTo:other];
  other->timerId_ = timerId_;
  other->timers_ = timers_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "nativeCancelTimerWithId:", "nativeCancelTimer", "V", 0x10a, NULL },
    { "nativeHandleWithId:withId:", "nativeHandle", "V", 0x10a, NULL },
    { "nativeScheduleTimerWithInt:withBoolean:withComGoodowRealtimeCoreHandler:", "nativeScheduleTimer", "Ljava.lang.Object;", 0x10a, NULL },
    { "cancelTimerWithInt:", "cancelTimer", "Z", 0x1, NULL },
    { "handleWithId:withId:", "handle", "V", 0x1, NULL },
    { "scheduleDeferredWithComGoodowRealtimeCoreHandler:", "scheduleDeferred", "V", 0x101, NULL },
    { "scheduleDelayWithInt:withComGoodowRealtimeCoreHandler:", "scheduleDelay", "I", 0x1, NULL },
    { "schedulePeriodicWithInt:withComGoodowRealtimeCoreHandler:", "schedulePeriodic", "I", 0x1, NULL },
    { "init", NULL, NULL, 0x0, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "timerId_", NULL, 0x12, "Ljava.util.concurrent.atomic.AtomicInteger;", NULL,  },
    { "timers_", NULL, 0x12, "Lcom.goodow.realtime.json.JsonObject;", NULL,  },
  };
  static const J2ObjcClassInfo _ComGoodowRealtimeObjcObjCScheduler = { 1, "ObjCScheduler", "com.goodow.realtime.objc", NULL, 0x0, 9, methods, 2, fields, 0, NULL};
  return &_ComGoodowRealtimeObjcObjCScheduler;
}

@end

void ComGoodowRealtimeObjcObjCScheduler_nativeCancelTimerWithId_(id timer) {
  ComGoodowRealtimeObjcObjCScheduler_init();
  [(NSTimer *)timer invalidate];
}

void ComGoodowRealtimeObjcObjCScheduler_nativeHandleWithId_withId_(id handler, id event) {
  ComGoodowRealtimeObjcObjCScheduler_init();
  GDCMessageHandler block = (GDCMessageHandler)handler;
  block(event);
}

id ComGoodowRealtimeObjcObjCScheduler_nativeScheduleTimerWithInt_withBoolean_withComGoodowRealtimeCoreHandler_(jint delayMs, jboolean repeat, id<ComGoodowRealtimeCoreHandler> handler) {
  ComGoodowRealtimeObjcObjCScheduler_init();
  return
  [NSTimer scheduledTimerWithTimeInterval:delayMs/1000
  target:handler
  selector:@selector(handleWithId:)
  userInfo:nil
  repeats:repeat];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComGoodowRealtimeObjcObjCScheduler)
